# Описание таблиц

### fw_departments - Департаменты
| Столбец | Описание |
| --- | --- |
|ID_DEPARTMENT|Уникальный код департамента|
|ID_PARENT|Ссылка на код, являющийся родителем|
|V_NAME|Уникальное наменование|
|B_DELETED|Признак удаленности записи|

### fw_contracts - Контракты
| Столбец | Описание |
| --- | --- |
|ID_CONTRACT_INST|Идентификатор контракта|
|DT_STOP|Дата конца действия записи|
|DT_START|Дата начала действия записи|
|ID_REC|Идентификатор записи|
|ID_CLIENT_INST|Идентификатор клиента|
|ID_CURRENCY|Валюта контракта|
|V_STATUS|Статус А активен,B заблокирован,С расторжен,D удален|
|DT_REG_EVENT|Дата регистрации|
|V_DESCRIPTION|Описание контракта|
|ID_DEPARTMENT|Код департамента|
|ID_CATEGORY|Код котегории контракта|
|V_EXT_IDENT|Внешний идентификатор контракта|

### fw_service - Типы услуг
| Столбец | Описание |
| --- | --- |
|ID_SERVICE|Код типа услуги|
|V_NAME|Название типа услуги|
|V_DESCR|Описание  типа  услуги|
|ID_SERVICE_CATEGORY|Идентификатор категории услуг|
|B_CAN_BE_BLOCKED|Может ли быть заблокирована (1 - может, 0 - не может)|
|B_DELETED|Признак удаленности записи|
|V_EXT_IDENT|Код типа услуги для внешней системы|
|V_MNEMONIC|Мнемоника котрую будет использовать загрузчик|
|B_ADD_SERVICE|Признак того что тип услуги предназначен для дополнительных услуг|
|N_PRIORITY|Приоритет типа услуги|

### fw_services - Экземпляры услуг
| Столбец | Описание |
| --- | --- |
|ID_CONTRACT_INST|Код экземпляра контракта|
|ID_SERVICE_INST|Код экземпляра услуги|
|B_DELETED|Признак удалённой записи|
|DT_STOP|Дата окончания действия услуги|
|DT_START|Дата начала действия услуги|
|ID_REC|Уникальный код записи по всей базе|
|ID_SUBSCRIBER_INST|Код экземпляра абонента|
|ID_PRODUCT_INST|Код экземпляра продукта|
|ID_TARIFF_PLAN|Код тарифного плана продукта|
|ID_PARENT_INST|Код экземпляра услуги родителя|
|ID_DEPENDENCY_INST|Код экземпляра услуги, от которого зависит|
|ID_SERVICE|Код типа услуги|
|ID_FLOW|Код заказа|
|ID_MANAGER|Код пользователя|
|DT_UPDATED|Дата последнего обновления записи в таблице|
|DT_PLAN|Дата планового подключеная услуги|
|V_EXT_IDENT|Идентификатор записи для внешней системы|
|V_STATUS|Статус услуги: "A" - активный; "D" - удаленный|
|DT_INIT|Дата фактического подключеная услуги|

### fw_tariff_plan - Тарифные планы
| Столбец | Описание |
| --- | --- |
|ID_TARIFF_PLAN|Код тарифного плана|
|N_MAJOR_VER|Версия|
|N_MINOR_VER|Релиз|
|DT_START|Дата начала тарифного плана|
|DT_STOP|Дата окончания тарифного плана|
|DT_SALE_START|Дата начала выхода на продажу тарифного плана|
|DT_SALE_STOP|Дата окончания выхода на продажу тарифного плана|
|V_NAME|Название тарифного плана|
|V_DESCR|Описание тарифного плана|
|V_EXT_IDENT|Идентификатор тарифного плана из внешней системы|
|ID_CURRENCY|Код валюты|
|ID_PRODUCT|Код типа продукта для которого применим данный тарифный план|
|ID_REC|Уникальный идентификатор записи по всей базе|
|N_PERIOD_LENGTH|Длина периода для списания абонплаты от услуг по этому тарифному плану|
|B_FIXED_PERIOD|Признак фиксированности периода (не фиксированных пока нету)|
|B_ACTIVE|Признак активности тарифного плана: 0 - Архивный; 1 - Действующий; 2 - Создаваемый|
|B_DELETED|Признак удаленности записи|
|B_DEFAULT_TP|Признак базовости тарифного плана|
|ID_DEFAULT_TP|Ссылка на базовый тарифный план|
|DT_STATE_CHANGE|Дата последнего измененаия|
|V_VERSION_DESCR|Описание данной версии и рилиза|
|ID_MANAGER|Код пользователя|
|ID_DEPARTMENT|Уникальный код департамента|

### fw_services_cost - Стоимости АП за услуги
| Столбец | Описание |
| --- | --- |
|ID_CONTRACT_INST|Идентификатор контракта|
|ID_CALC_RC_MODE|Режим игнорирования блокировок|
|DT_STOP|Дата окончания действия указанной стоимости|
|ID_SERVICE_INST|Идентификатор экземпляра услуги|
|DT_START|Дата начала действия указанной стоимости|
|N_COST_PERIOD|Сумма АП за период (согласно ТП)|
|N_DISCOUNT_PERIOD|Сумма скидки на АП за период (согласно ТП и настроенным скидкам)|

# Задачи
1. Найти всех абонентов, чья абон.плата больше средней абон.платы (пофилиально). <br> _Результат_: номер договора и величина АП.
2. Найти услуги всех абонентов, чья абон.плата больше средней абон.платы (пофилиально).<br> _Результат_: название услуги, филиал, величина сумм АП за услугу внутри филиала.
3. Найти всех абонентов, у которых величина скидки на услугах менялась 2 и более раз в течение ноября 2017.<br> _Результат_: 1) номер договора, сумма АП на текущий момент; 2) номер договора, количество изменений величины скидок на услугах.
4. (*) Найти всех абонентов, у которых величина АП на последний день месяца только уменьшалась в течение последних 6 месяцев.<br> _Результат_: 1) номер договора, разница между АП на последний день предыдущего месяца и последний день месяца полгода назад; 2) номер договора, наименование тарифных планов абонента.
5. Вывести названия услуг из топ-5 по величине АП на текущий момент.<br> _Результат_: филиал, тип услуги, суммарная величина АП по услуге в филиале. 
6. Вывести названия ТП из топ-5 по величине АП на последний день прошедшего месяца.<br> _Результат_: филиал, ТП, суммарная величина АП по ТП в филиале. 
7. (*) Вывести самую популярную и самую непопулярную услуги в рамках филиалах.
8. Вывести количество услуг на контрактах, которые входят в топ 30% по величине АП на текущий момент пофилиально.<br> _Результат_: номер договора, наименование филиала, количество услуг.
9. Вывести количество основных и доп.услуг на контрактах, которые входят в топ 45% по величине АП за доп.услуги(!) на текущий момент пофилиально.<br> _Результат_: номер договора, наименование филиала, кол-во основных услуг, кол-во доп.услуг.
10. Вывести номера договоров, на которых отношение суммарной АП за услуги на текущий момент к суммарной скидке за услуги на текущий момент максимально по всем филиалам. 2) ... внутри филиала.<br> _Результат_: номер договора, наименование филиала, величина АП, величина скидки.
11. Вывести самый прибыльный ТП с точки зрения суммарной АП за доп.услуги пофилиально.<br> _Результат_: название филиала, название ТП, величина АП.
12. Вывести номера контрактов с наибольшей и наименьшой суммой АП на текущий момент пофилиально.<br> _Результат_: номера договоров в строку, признак "Максимум"/"Минимум", название филиала.
13. Вывести названия ТП с наибольшей суммой АП на текущий момент пофилиально, а для филиала "АЛМАТЫ" вывести и с наименьшей суммой АП.<br> _Результат_: название ТП, филиал, признак "Максимум"/"Минимум".
14. (*) Придумать в рамках таблиц из "Описания таблиц" задачу с применением NTILE и решить её;
15. (*) Придумать в рамках таблиц из "Описания таблиц" задачу с применением FIRST_VALUE или LAST_VALUE и решить её;
